<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Exchange</title>
        <style>
            #oreder_book strong {
                color: white;
                background-color: black;
                padding: 2px;
            }
        </style>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
        <script src="/socket.io/socket.io.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.4.2/css/tabulator.min.css" rel="stylesheet">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.4.2/js/tabulator.min.js"></script>
    </head>
 
    <body>
        <h1>Trade bananas for apples!</h1>

        <form action="/" method="post" id="formulaire_trade">
            <input type="text" name="price" id="price" placeholder="Price" size="50" autofocus />
            <input type="text" name="volume" id="volume" placeholder="Volume" size="50" autofocus />
            <input type="submit" id="envoi_trade" value="Envoyer" />
        </form>
        <select name="askbid" id="askbid" >
          <option value="ask">ask</option>
          <option value="bid">bid</option>
        </select>


        <div id="order_book"></div>

        <script>

            // Connecting to socket.io
            var socket = io.connect('http://localhost:8080');

            // When we receive the order book, we display it
            socket.on('orderBook', function(orderBook){
                $("#order_book").tabulator("setData", orderBook);
            })

            // When submitting the form, we send the trade to the server
            $('#formulaire_trade').submit(function () {
                var price = $('#price').val();
                var volume = $('#volume').val();
                var askbid = $('#askbid').val();
                
                //Sending the trade to the server
                socket.emit('trade', price, volume, askbid);

                //Free the text area input
                $('#price').val('').focus(); 
                $('#volume').val('').focus(); 
                return false;
            }); 
            
            // Setting up order book table fields 
            $("#order_book").tabulator({
                rowFormatter:function(row){
                    if(row.getData().askbid == "ask"){
                        row.getElement().css({"background-color":"#00dd00"});
                    }else{
                        row.getElement().css({"background-color":"#dd0000"});
                    }
                },
              columns:[
                {title:"ID", field:"id", sortable:true, sorter:"number"},
                {title:"Price", field:"price", sortable:true, sorter:"number"},
                {title:"Volume", field:"volume", sortable:true, sorter:"number"},
                {title:"Side", field:"askbid", sortable:true},
                {title:"Date", field:"time", sortable:true, sorter:"number"},
              ],
            });
        </script>
    </body>
</html>

