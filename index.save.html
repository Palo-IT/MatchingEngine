<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Exchange</title>
        <style>
            #oreder_book strong {
                color: white;
                background-color: black;
                padding: 2px;
            }
        </style>
    </head>
 
    <body>
        <h1>Trade bananas for apples!</h1>

        <form action="/" method="post" id="formulaire_trade">
            <input type="text" name="price" id="price" placeholder="Price" size="50" autofocus />
            <input type="text" name="volume" id="volume" placeholder="Volume" size="50" autofocus />
            <input type="submit" id="envoi_trade" value="Envoyer" />
        </form>
        <select name="askbid" id="askbid" >
          <option value="ask">ask</option>
          <option value="bid">bid</option>
        </select>


        <table id="order_book">
            <caption>Order Book</caption>
            <thead>
            <tr>
                <th>ID</th>
                <th>Price</th>
                <th>Volume</th>
                <th>Type</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
        </table>

        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            // Connecting to socket.io
            var socket = io.connect('http://localhost:8080');

            // When we receive the order book, we display it
            socket.on('orderBook', function(orderBook){
                for(var i=0; i<orderBook.length;i++){
                    insereTrade(orderBook[i]['id'],orderBook[i]['price'],orderBook[i]['volume'],orderBook[i]['askbid'],orderBook[i]['time']);
                }
            })

            // When submitting the form, we send the trade to the server
            $('#formulaire_trade').submit(function () {
                var price = $('#price').val();
                var volume = $('#volume').val();
                var askbid = $('#askbid').val();
                
                //Sending the trade to the server
                socket.emit('trade', price, volume, askbid);

                //Free the text area input
                $('#price').val('').focus(); 
                $('#volume').val('').focus(); 
                return false;
            }); 
            
            // Insert a trade into the page
            function insereTrade(id, price, volume, askbid, date) {
                $('#order_book tr:last').after('<tr id=\'' + id + '\'><td>' + id + '</td><td>' + price + '</td><td>' + volume + '</td><td>' + askbid +'</td><td>'+ date + '</td></tr>');
            }
        </script>
    </body>
</html>

